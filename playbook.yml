---
- name: common configuration for all systems
  hosts: all
  remote_user: root
  become: true

  roles:
    - geerlingguy.git
    - geerlingguy.nodejs

  tasks:
    - name: expect dep
      apt:
        name: expect

    - name: install node packages for bot
      npm:
        path: /vagrant

    - name: clone byteball core
      git:
        repo: "https://github.com/byteball/byteballcore.git"
        dest: /home/ubuntu/byteballcore

    - name: clone headless wallet
      git:
        repo: "https://github.com/byteball/headless-byteball.git"
        dest: /home/ubuntu/headless-byteball

    - name: install headless wallet dependencies
      npm:
        path: /home/ubuntu/headless-byteball

    - copy:
        src: /vagrant/byteball-headless.service
        dest: /lib/systemd/system/byteball-headless.service

    - systemd:
        name: byteball-headless
        daemon_reload: yes
        state: started
